---
title: "Using R for Data Analysis"
subtitle: ""
author: "Elizabeth Davis"
institute: "San Diego Zoo Global"
date: "2019/05/08 (updated: 2020-06-25)"
output:
  xaringan::moon_reader:
    css: [default, rladies, rladies-fonts]
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<style type="text/css">
/* custom.css */
.left-code {
  color: #777;
  width: 38%;
  height: 92%;
  float: left;
}
.right-plot {
  width: 60%;
  float: right;
  padding-left: 1%;
}
.plot-callout {
  height: 225px;
  width: 450px;
  bottom: 5%;
  right: 5%;
  position: absolute;
  padding: 0px;
  z-index: 100;
}
.plot-callout img {
  width: 100%;
  border: 4px solid #23373B;
}
</style>
<div id="how-to-use-r-scripts-effectively" class="section level1">
<h1>How to use R Scripts effectively</h1>
<p>–</p>
<div id="go-ahead-and-open-an-r-script-on-your-r-studio.-it-will-be-the-icon-in-the-top-left-of-your-console.-it-looks-like-this" class="section level2">
<h2>Go ahead and open an R script on your R studio. It will be the icon in the top left of your console. It looks like this:</h2>
<div class="figure">
<img src="images/r-script-icon.png" alt="" />
<p class="caption">R Script icon</p>
</div>
</div>
</div>
<div id="r-scripts-are-where-you-keep-your-code-so-they-are-also-where-you-should-include-comments-i.e.-a-way-of-explaining-to-othersyour-future-self-what-you-have-done" class="section level1">
<h1>R Scripts are where you keep your code, so they are also where you should include <em>comments</em>, i.e. a way of explaining to others/your future self what you have done</h1>
<hr />
<div id="the-most-important-thing-is-to-use-them-as-though-you-may-be-hit-on-the-head-and-lose-your-memory-at-any-moment.-be-very-clear-about-your-process-and-why-you-are-doing-what-you-are." class="section level2">
<h2>The most important thing is to use them as though <em>you may be hit on the head and lose your memory at any moment</em>. Be VERY clear about your process and why you are doing what you are.</h2>
<hr />
<div class="figure">
<img src="images/r-script-example.png" alt="" />
<p class="caption">R Script example</p>
</div>
<hr />
<p>#How to use R studio</p>
<p>–</p>
</div>
<div id="r-studio-has-a-lot-of-in-built-tools-that-help-with-effective-coding." class="section level2">
<h2>R Studio has a lot of in-built tools that help with effective coding.</h2>
<p>–</p>
</div>
<div id="for-example-r-will-automatically-close-parantheses-and-quotation-marks-for-you-however-you-need-to-be-careful-that-this-doesnt-cause-mistakes." class="section level2">
<h2>For example, R will automatically close parantheses and quotation marks for you; however, you need to be careful that this doesn’t cause mistakes.</h2>
<p>–</p>
</div>
<div id="r-studio-will-also-show-you-when-you-make-a-mistake-in-your-r-script-through-red-lines-underlining-code-and-a-red-x" class="section level2">
<h2>R Studio will also show you when you make a mistake in your R Script, through red lines underlining code and a red “X”</h2>
<hr />
</div>
<div id="r-script-example-of-errors" class="section level2">
<h2><img src="images/r-script-errors.png" alt="R Script example of errors" /></h2>
<div id="you-can-see-here-where-r-is-telling-you-that-your-code-is-faulty." class="section level3">
<h3>You can see here where R is telling you that your code is faulty.</h3>
<p>–</p>
</div>
<div id="you-can-also-see-that-r-studio-will-color-code-differently-according-to-its-attribute-a-different-color-for-non-code-objects-for-comments-and-for-significant-commands-like-telling-r-which-library-to-use." class="section level3">
<h3>You can also see that R Studio will color code differently according to its attribute: a different color for non-code “objects”, for comments, and for “significant” commands like telling R which library to use.</h3>
<hr />
</div>
</div>
</div>
<div id="error-codes" class="section level1">
<h1>Error Codes</h1>
<table style="width:6%;">
<colgroup>
<col width="5%" />
</colgroup>
<thead>
<tr class="header">
<th>&lt;img src=“images/skipping-falling.gif”, width = “100%”&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>class: center, middle</td>
</tr>
<tr class="even">
<td>## “Start associating error messages with joy because it probably means you are about to learn something!”</td>
</tr>
</tbody>
</table>
</div>
<div id="what-do-to-do-when-you-get-an-error-code" class="section level1">
<h1>What do to do when you get an error code</h1>
<p>–</p>
<div id="read-the-code.-this-seems-self-explanatory-but-it-is-where-you-can-gain-some-understanding-of-what-went-wrong." class="section level2">
<h2>Read the code. This seems self-explanatory but it is where you can gain some understanding of what went wrong.</h2>
<p>–</p>
</div>
<div id="as-an-example-what-happens-if-you-type-a-and-press-enter" class="section level2">
<h2>As an example, what happens if you type “a” and press enter?</h2>
<p>–</p>
</div>
<div id="error-example" class="section level2">
<h2><img src="images/error.png" alt="Error example" /></h2>
<div class="figure">
<img src="images/error.png" alt="" />
<p class="caption">Error example</p>
</div>
<p>–</p>
</div>
<div id="this-message-has-three-parts" class="section level2">
<h2>This message has <strong>three</strong> parts</h2>
<p>–</p>
<div id="it-tells-us-that-it-is-an-error" class="section level3">
<h3>1) It tells us that it is an error</h3>
<p>–</p>
</div>
<div id="the-location-of-the-error-which-is-object-a" class="section level3">
<h3>2) The location of the error, which is object “a”</h3>
<p>–</p>
</div>
<div id="the-problem-this-mistake-caused-there-is-no-object-a-because-i-havent-created-it" class="section level3">
<h3>3) The problem this mistake caused: there is no object a, because I haven’t created it!</h3>
<hr />
</div>
</div>
</div>
<div id="sometimes-errors-are-difficult-to-understand" class="section level1">
<h1>Sometimes errors are difficult to understand</h1>
<p>–</p>
<div id="if-you-cant-understand-the-error-message-immediately-then-you-have-several-options" class="section level2">
<h2>If you can’t understand the error message immediately, then you have several options:</h2>
<p>–</p>
<div id="check-out-the-help-file-for-the-functioncommand-you-are-using-if-applicable" class="section level3">
<h3>1) Check out the help file for the function/command you are using, if applicable</h3>
<p>–</p>
</div>
<div id="google-it" class="section level3">
<h3>2) Google it!</h3>
<p>–</p>
</div>
<div id="ask-for-help-from-stack-overflow-bearing-in-mind-that-it-can-be-challenging-or-from-r-ladies-if-you-are-a-woman--sorry-guys" class="section level3">
<h3>3) Ask for help from Stack Overflow (bearing in mind that it can be challenging) or from R-Ladies (if you are a woman- sorry guys!)</h3>
<hr />
</div>
</div>
</div>
<div id="checking-out-the-help-file" class="section level1">
<h1>Checking out the help file</h1>
<p>–</p>
<div id="the-help-file-can-be-challenging-to-understand-so-googling-may-be-the-easiest-option-for-you.-however-it-is-important-to-be-familiar-with-r-helpfiles." class="section level2">
<h2>The help file can be challenging to understand, so Googling may be the easiest option for you. However, it is important to be familiar with R helpfiles.</h2>
<hr />
<div class="figure">
<img src="images/r-help-first-bit.png" alt="" />
<p class="caption">R help first bit</p>
</div>
<hr />
</div>
<div id="r-help-second-bit" class="section level2">
<h2><img src="images/r-help-second-bit.png" alt="R help second bit" /></h2>
</div>
</div>
<div id="using-r-for-data-analysis" class="section level1">
<h1>Using R for data analysis</h1>
<p>–</p>
<div id="statistics-and-data-analysis-is-a-problem-solving-and-decision-making-process-that-is-fundamental-to-scientific-inquiry-and-essential-for-making-sound-decisions." class="section level2">
<h2>“Statistics [and data analysis] is a problem-solving and decision-making process that is fundamental to scientific inquiry and essential for making sound decisions.”</h2>
<p>–</p>
<div id="requires-critical-thinking-and-practice" class="section level3">
<h3>Requires <strong>critical thinking</strong> (and practice!)</h3>
</div>
</div>
<div id="land-use-in-the-greater-mekong-region-2012" class="section level2">
<h2># Land use in the Greater Mekong Region: 2012</h2>
</div>
<div id="land-use-km" class="section level2">
<h2><img src="images/land-use-km.png" alt="land use km" /></h2>
</div>
<div id="land-use-percent" class="section level2">
<h2><img src="images/land-use-percent.png" alt="land use percent" /></h2>
<p>#Overall difference between the countries</p>
<pre class="r"><code>library(formatR)
land.indicators.2012.km &lt;- read.csv(&quot;land-indicators-2012-km.csv&quot;)
land.indicators.2012.percent &lt;- read.csv(&quot;land-indicators-2012-percent.csv&quot;)
# Land use by km2
summary(aov(land.indicators.2012.km$Amount ~ land.indicators.2012.km$Country))</code></pre>
<pre><code>##                                 Df    Sum Sq   Mean Sq F value Pr(&gt;F)
## land.indicators.2012.km$Country  4 1.068e+11 2.669e+10   0.822  0.531
## Residuals                       15 4.869e+11 3.246e+10</code></pre>
<pre class="r"><code># Land use by percent
summary(aov(land.indicators.2012.percent$Amount ~ land.indicators.2012.percent$Country))</code></pre>
<pre><code>##                                      Df Sum Sq Mean Sq F value Pr(&gt;F)  
## land.indicators.2012.percent$Country  4  984.6  246.15   5.756 0.0411 *
## Residuals                             5  213.8   42.76                 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<hr />
<p>#Where is the difference between countries found?</p>
<pre class="r"><code>TukeyHSD(aov(land.indicators.2012.percent$Amount ~ land.indicators.2012.percent$Country))</code></pre>
<pre><code>##   Tukey multiple comparisons of means
##     95% family-wise confidence level
## 
## Fit: aov(formula = land.indicators.2012.percent$Amount ~ land.indicators.2012.percent$Country)
## 
## $`land.indicators.2012.percent$Country`
##                         diff        lwr       upr     p adj
## Laos-Cambodia     -19.424650 -45.656703  6.807403 0.1396226
## Myanmar-Cambodia   -9.995385 -36.227438 16.236668 0.5884065
## Thailand-Cambodia   9.686365 -16.545688 35.918418 0.6119421
## Vietnam-Cambodia   -0.111285 -26.343338 26.120768 1.0000000
## Myanmar-Laos        9.429265 -16.802788 35.661318 0.6317063
## Thailand-Laos      29.111015   2.878962 55.343068 0.0335155
## Vietnam-Laos       19.313365  -6.918688 45.545418 0.1420955
## Thailand-Myanmar   19.681750  -6.550303 45.913803 0.1340816
## Vietnam-Myanmar     9.884100 -16.347953 36.116153 0.5968497
## Vietnam-Thailand   -9.797650 -36.029703 16.434403 0.6034348</code></pre>
<hr />
</div>
<div id="what-does-this-tell-us" class="section level2">
<h2>What does this tell us?</h2>
<p>–</p>
<pre class="r"><code>TukeyHSD(aov(land.indicators.2012.percent$Amount ~ land.indicators.2012.percent$Country))</code></pre>
<pre><code>##   Tukey multiple comparisons of means
##     95% family-wise confidence level
## 
## Fit: aov(formula = land.indicators.2012.percent$Amount ~ land.indicators.2012.percent$Country)
## 
## $`land.indicators.2012.percent$Country`
##                         diff        lwr       upr     p adj
## Laos-Cambodia     -19.424650 -45.656703  6.807403 0.1396226
## Myanmar-Cambodia   -9.995385 -36.227438 16.236668 0.5884065
## Thailand-Cambodia   9.686365 -16.545688 35.918418 0.6119421
## Vietnam-Cambodia   -0.111285 -26.343338 26.120768 1.0000000
## Myanmar-Laos        9.429265 -16.802788 35.661318 0.6317063
## Thailand-Laos      29.111015   2.878962 55.343068 0.0335155
## Vietnam-Laos       19.313365  -6.918688 45.545418 0.1420955
## Thailand-Myanmar   19.681750  -6.550303 45.913803 0.1340816
## Vietnam-Myanmar     9.884100 -16.347953 36.116153 0.5968497
## Vietnam-Thailand   -9.797650 -36.029703 16.434403 0.6034348</code></pre>
<p>#How did I get to this point?</p>
<p>–</p>
<p>##First, by looking at the data as it was in the <code>.csv</code> file.
<img src="images/original-data.png" alt="original data" /></p>
<hr />
<p>##Because this is a pretty simple dataset, I decided to do a basic analysis where I try to understand the difference between the countries. I decided to start by <strong>visualizing the data</strong>, using <code>ggplot2</code>. (Hopefully you all remember how to use it!)</p>
<div id="but-it-wasnt-as-easy-as-doing-this-for-the-whole-dataset.-when-i-looked-at-the-data-the-data-was-represented-in-different-formats-kilometers-squared-and-percent.-so-i-had-to-create-two-datasets." class="section level3">
<h3>BUT, it wasn’t as easy as doing this for the whole dataset. When I looked at the data, the data was represented in different formats, <em>kilometers squared</em> and <em>percent</em>. So, I had to create two datasets.</h3>
<p>.pull-left[
###<strong>km2</strong>
<img src="images/km2-data.png" alt="km2 data" />]</p>
<p>.pull-right[
###<strong>percent</strong>
<img src="images/percent-data.png" alt="percent data" />]
—
class: center, middle</p>
</div>
</div>
<div id="hopefully-you-can-see-here-why-we-couldnt-plot-these-together.-kilometers-squared-is-on-a-much-larger-scale-than-percent-i.e.-200000-versus-35." class="section level2">
<h2>Hopefully you can see here why we couldn’t plot these together. Kilometers squared is on a much larger scale than percent, i.e. 200,000 versus 35.</h2>
<hr />
<p>To plot this data, I used the following code. Again, this took me some trial and error to get it right for both graphs.</p>
<pre class="r"><code>require(tidyverse)
require(scales)
ggplot(land.indicators.2012.km, aes(x = Country, y = Amount, fill = Country)) +
  geom_bar(stat = &quot;identity&quot;) + 
  theme_bw() +
  scale_fill_viridis_d() +
  facet_wrap(~Land.Use.Type) + 
  scale_y_continuous(name=&quot;Country&quot;, labels = comma) +
  ggtitle(&quot;Land Use Types Between Countries (km2)&quot;) +
  theme(text = element_text(size = 20)) </code></pre>
<pre class="r"><code>ggplot(land.indicators.2012.percent, aes(x = Country, y = Amount, fill = Country)) +
  geom_bar(stat = &quot;identity&quot;) + 
  theme_bw() +
  scale_fill_viridis_d() +
  facet_wrap(~Land.Use.Type) + 
  scale_y_continuous(name=&quot;Country&quot;, labels = comma) +
  ggtitle(&quot;Land Use Types Between Countries (%)&quot;) +
  theme(text = element_text(size = 20)) +
  scale_x_discrete(limits=c(&quot;Thailand&quot;,&quot;Vietnam&quot;,&quot;Cambodia&quot;, &quot;Myanmar&quot;, &quot;Laos&quot;))</code></pre>
<hr />
<div class="figure">
<img src="images/land-use-km.png" alt="" />
<p class="caption">land use km</p>
</div>
<hr />
<div class="figure">
<img src="images/land-use-percent.png" alt="" />
<p class="caption">land use percent</p>
</div>
<hr />
</div>
<div id="as-you-saw-after-visualizing-these-graphs-i-decided-to-perform-an-anova-on-country-and-amount-of-km2percent-of-land-used-for-other-purposes-to-see-whether-the-country-differences-seen-are-significant." class="section level2">
<h2>As you saw, after visualizing these graphs, I decided to perform an ANOVA on <em>country</em> and <em>amount</em> (of km2/percent of land used for other purposes), to see whether the country differences seen are significant.</h2>
<div id="the-anova-for-percent-was-significant-so-i-performed-the-follow-up-test-of-tukeys-hsd-to-determine-where-the-difference-was-and-found-that-thailand-and-laos-significantly-differed-in-the-percent-of-their-land-used-for-agriculture." class="section level3">
<h3>The ANOVA for percent was significant, so I performed the follow-up test of TUKEY’s HSD to determine where the difference was, and found that Thailand and Laos significantly differed in the percent of their land used for agriculture.</h3>
<hr />
</div>
</div>
<div id="and-thats-it-there-are-probably-all-kinds-of-better-and-more-interesting-things-that-could-be-done-with-that-data-but-that-will-do-for-now." class="section level2">
<h2>And that’s it! There are probably all kinds of better and more interesting things that could be done with that data, but that will do for now.</h2>
<hr />
<p>background-image: url(“images/mountain.jpg”)
class: center, middle, inverse</p>
</div>
<div id="lets-take-a-break" class="section level2">
<h2>Let’s take a break</h2>
<hr />
</div>
</div>
<div id="tidying-our-data-with-dplyr" class="section level1">
<h1>Tidying our data with <code>dplyr</code></h1>
<table style="width:4%;">
<colgroup>
<col width="4%" />
</colgroup>
<tbody>
<tr class="odd">
<td>class: center, middle</td>
</tr>
<tr class="even">
<td>## <code>dplyr</code> is a package within the <code>tidyverse</code>. It is widely used in R data analysis because it is quick and efficient at cleaning and sorting data.</td>
</tr>
<tr class="odd">
<td><br><br><br><br><br><br><br><br></td>
</tr>
<tr class="even">
<td>#### Disclaimer: I am not very good at using <code>dplyr</code> myself! So we will both be learning.</td>
</tr>
</tbody>
</table>
<p>class: center, middle</p>
<div id="first-we-will-load-the-tidyverse-package-install-it-if-you-havent-already." class="section level2">
<h2>First, we will load the <code>tidyverse</code> package (install it if you haven’t already).</h2>
<div id="were-going-to-learn-some-of-the-most-common-dplyr-functions-select-filter-mutate-group_by-and-summarise." class="section level3">
<h3>We’re going to learn some of the most common dplyr functions: <code>select()</code>, <code>filter()</code>, <code>mutate()</code>, <code>group_by()</code>, and <code>summarise()</code>.</h3>
<hr />
</div>
</div>
</div>
<div id="select" class="section level1">
<h1><code>select()</code></h1>
<p>–</p>
<div id="as-the-name-implies-this-is-where-we-select-the-columns-that-we-want-to-keep-in-a-data-frame." class="section level2">
<h2>As the name implies, this is where we <em>select</em> the columns that we want to keep in a data frame.</h2>
<p>–</p>
<div id="but-first-youll-need-to-load-the-data.-do-the-following" class="section level3">
<h3>But first, you’ll need to load the data. Do the following:</h3>
<pre class="r"><code>library(nycflights13)
flights</code></pre>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      542            540         2      923            850
##  4  2013     1     1      544            545        -1     1004           1022
##  5  2013     1     1      554            600        -6      812            837
##  6  2013     1     1      554            558        -4      740            728
##  7  2013     1     1      555            600        -5      913            854
##  8  2013     1     1      557            600        -3      709            723
##  9  2013     1     1      557            600        -3      838            846
## 10  2013     1     1      558            600        -2      753            745
## # … with 336,766 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<div id="and-take-a-look-at-our-data-using-all-of-the-tools-i-taught-you-in-the-first-course-head-summary-and-one-you-may-not-have-used-previously-str." class="section level4">
<h4>And take a look at our data using all of the tools I taught you in the first course (<code>head</code>, <code>summary</code>, and one you may not have used previously: <code>str</code>).</h4>
<hr />
</div>
</div>
</div>
</div>
<div id="using-select-on-your-data" class="section level1">
<h1>Using <code>select()</code> on your data</h1>
<p>–</p>
<div id="the-first-argument-to-this-function-is-the-data-frame-which-dplyr-calls-a-tibble-and-the-subsequent-arguments-are-the-columns-to-keep." class="section level3">
<h3>The first argument to this function is the data frame (which <code>dplyr</code> calls a tibble), and the subsequent arguments are the columns to keep.</h3>
</div>
<div id="for-our-data-in-flights-lets-use-select-to-choose-some-columns-to-keep." class="section level3">
<h3>For our data in <code>flights</code>, let’s use <code>select</code> to choose some columns to keep.</h3>
<pre class="r"><code>dplyr::select(flights, year, month, day)</code></pre>
<pre><code>## # A tibble: 336,776 x 3
##     year month   day
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1  2013     1     1
##  2  2013     1     1
##  3  2013     1     1
##  4  2013     1     1
##  5  2013     1     1
##  6  2013     1     1
##  7  2013     1     1
##  8  2013     1     1
##  9  2013     1     1
## 10  2013     1     1
## # … with 336,766 more rows</code></pre>
<hr />
</div>
</div>
<div id="easy-right-now-lets-choose-some-rows-to-work-with-using-filter." class="section level1">
<h1>Easy, right? Now let’s choose some rows to work with using <code>filter</code>.</h1>
<pre class="r"><code>dplyr::filter(flights, month == 1, day == 1)</code></pre>
<pre><code>## # A tibble: 842 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      542            540         2      923            850
##  4  2013     1     1      544            545        -1     1004           1022
##  5  2013     1     1      554            600        -6      812            837
##  6  2013     1     1      554            558        -4      740            728
##  7  2013     1     1      555            600        -5      913            854
##  8  2013     1     1      557            600        -3      709            723
##  9  2013     1     1      557            600        -3      838            846
## 10  2013     1     1      558            600        -2      753            745
## # … with 832 more rows, and 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;,
## #   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
## #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<hr />
<div id="this-lets-us-filter-our-data-so-that-it-only-shows-flights-on-january-1st." class="section level2">
<h2>This lets us filter our data so that it only shows flights on January 1st.</h2>
<p>–</p>
<div id="remember-if-you-want-to-use-these-commands-to-create-a-new-dataframe-you-need-to-apply-these-commands-to-an-object-i.e." class="section level3">
<h3>**Remember, if you want to use these commands to create a new dataframe, you need to apply these commands to an object, i.e.:</h3>
<p>–</p>
<pre class="r"><code>jan_first_flights &lt;- dplyr::filter(flights, month == 1, day == 1) #&lt;&lt;</code></pre>
<hr />
</div>
</div>
</div>
<div id="but-what-if-you-want-to-use-select-and-filter" class="section level1">
<h1>But what if you want to use <code>select</code> AND <code>filter</code>?</h1>
<p>–</p>
<div id="we-use-something-called-pipes.-pipes-look-like-this-.-they-take-the-output-of-one-command-and-put-it-directly-into-the-next." class="section level2">
<h2>We use something called <strong>pipes</strong>. Pipes look like this <code>%&gt;%</code>. They take the output of one command and put it directly into the next.</h2>
<p>–</p>
<div id="example" class="section level3">
<h3>Example:</h3>
<pre class="r"><code>flights %&gt;%
  dplyr::filter(month == 1) %&gt;%
  dplyr::select(year, month, day, dep_delay)</code></pre>
<pre><code>## # A tibble: 27,004 x 4
##     year month   day dep_delay
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;
##  1  2013     1     1         2
##  2  2013     1     1         4
##  3  2013     1     1         2
##  4  2013     1     1        -1
##  5  2013     1     1        -6
##  6  2013     1     1        -4
##  7  2013     1     1        -5
##  8  2013     1     1        -3
##  9  2013     1     1        -3
## 10  2013     1     1        -2
## # … with 26,994 more rows</code></pre>
</div>
</div>
</div>
<div id="exercise" class="section level1">
<h1>Exercise</h1>
<p>–</p>
<div id="using-pipes-subset-flights-to-include-rows-where-the-year-is-2013-and-keep-only-the-columns-year-month-and-dep_delay." class="section level2">
<h2>Using pipes, subset <code>flights</code> to include rows where the year is 2013 and keep only the columns year, month, and dep_delay.</h2>
<div id="how-many-rows-are-in-that-tibble" class="section level3">
<h3>How many rows are in that tibble?</h3>
<p>HINT: You can use the nrow() function to find out how many rows are in a tibble.</p>
<hr />
</div>
</div>
</div>
<div id="mutate" class="section level1">
<h1><code>mutate</code></h1>
<div id="frequently-youll-want-to-create-new-columns-based-on-the-values-in-existing-columns-for-example-to-do-unit-conversions-or-find-the-ratio-of-values-in-two-columns.-for-this-well-use-mutate" class="section level2">
<h2>Frequently you’ll want to create new columns based on the values in existing columns, for example to do unit conversions or find the ratio of values in two columns. For this we’ll use <code>mutate()</code></h2>
<table style="width:4%;">
<colgroup>
<col width="4%" />
</colgroup>
<tbody>
<tr class="odd">
<td>### Let’s create a new column of the flight duration. We can do this by using mutate and subtracting <code>arr_time</code> (arrival time) from the <code>dep_time</code> (departure time).</td>
</tr>
<tr class="even">
<td><code>r flights %&gt;% mutate(duration = arr_time - dep_time)</code></td>
</tr>
<tr class="odd">
<td><code>## # A tibble: 336,776 x 20 ##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time ##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt; ##  1  2013     1     1      517            515         2      830            819 ##  2  2013     1     1      533            529         4      850            830 ##  3  2013     1     1      542            540         2      923            850 ##  4  2013     1     1      544            545        -1     1004           1022 ##  5  2013     1     1      554            600        -6      812            837 ##  6  2013     1     1      554            558        -4      740            728 ##  7  2013     1     1      555            600        -5      913            854 ##  8  2013     1     1      557            600        -3      709            723 ##  9  2013     1     1      557            600        -3      838            846 ## 10  2013     1     1      558            600        -2      753            745 ## # … with 336,766 more rows, and 12 more variables: arr_delay &lt;dbl&gt;, ## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, ## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, ## #   duration &lt;int&gt;</code></td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="split-apply-combine-data-analysis-and-the-summarize-function" class="section level1">
<h1>Split-apply-combine data analysis and the <code>summarize()</code> function</h1>
<p>–</p>
<div id="many-data-analysis-tasks-can-be-approached-using-the-split-apply-combine-paradigm" class="section level2">
<h2>Many data analysis tasks can be approached using the “split-apply-combine” paradigm:</h2>
<ol style="list-style-type: decimal">
<li>Split the data into groups</li>
</ol>
<p>–</p>
<ol start="2" style="list-style-type: decimal">
<li>Apply some analysis to each group</li>
</ol>
<p>–</p>
<ol start="3" style="list-style-type: decimal">
<li>And then combine the results.</li>
</ol>
<p>–</p>
<p><code>dplyr</code> makes this very easy through the use of the <code>group_by()</code> function, which splits the data into groups.</p>
<hr />
</div>
<div id="when-the-data-is-grouped-in-this-way-summarize-can-be-used-to-collapse-each-group-into-a-single-row-summary.-summarize-does-this-by-applying-an-aggregating-or-summary-function-to-each-group.-for-example-if-we-wanted-to-group-by-month-and-find-the-number-of-rows-of-data-for-each-year-we-would-do" class="section level2">
<h2>When the data is grouped in this way <code>summarize()</code> can be used to collapse each group into a single-row summary. <code>summarize()</code> does this by applying an aggregating or summary function to each group. For example, if we wanted to group by month and find the number of rows of data for each year, we would do:</h2>
<p>–</p>
<pre class="r"><code>flights %&gt;%
  group_by(month) %&gt;%
  summarize(n())</code></pre>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 12 x 2
##    month `n()`
##    &lt;int&gt; &lt;int&gt;
##  1     1 27004
##  2     2 24951
##  3     3 28834
##  4     4 28330
##  5     5 28796
##  6     6 28243
##  7     7 29425
##  8     8 29327
##  9     9 27574
## 10    10 28889
## 11    11 27268
## 12    12 28135</code></pre>
<hr />
</div>
<div id="of-course-that-doesnt-tell-us-much-that-is-useful.-lets-look-at-the-mean-departure-delay-for-each-month." class="section level2">
<h2>Of course, that doesn’t tell us much that is useful. Let’s look at the mean departure delay for each month.</h2>
<p>–</p>
<pre class="r"><code>flights %&gt;%
  group_by(month) %&gt;%
  summarize(mean_dep_delay = mean(dep_delay, na.rm = TRUE))</code></pre>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 12 x 2
##    month mean_dep_delay
##    &lt;int&gt;          &lt;dbl&gt;
##  1     1          10.0 
##  2     2          10.8 
##  3     3          13.2 
##  4     4          13.9 
##  5     5          13.0 
##  6     6          20.8 
##  7     7          21.7 
##  8     8          12.6 
##  9     9           6.72
## 10    10           6.24
## 11    11           5.44
## 12    12          16.6</code></pre>
<p>–</p>
<div id="the-na.rm-here-is-where-we-tell-r-to-ignore-any-missing-data-which-usually-is-shown-as-na.-if-we-dont-use-this-command-and-we-have-missing-data-r-will-return-an-error." class="section level3">
<h3>The <code>na.rm</code> here is where we tell R to ignore any missing data which usually is shown as “NA”. If we don’t use this command and we have missing data, R will return an error.</h3>
<hr />
</div>
</div>
<div id="you-can-also-group-by-multiple-columns-which-is-very-handy" class="section level2">
<h2>You can also group by multiple columns, which is very handy!</h2>
<p>–</p>
<pre class="r"><code>flights %&gt;%
  group_by(carrier, month) %&gt;%
  summarize(mean_dep_delay = mean(dep_delay, na.rm = TRUE))</code></pre>
<pre><code>## `summarise()` regrouping output by &#39;carrier&#39; (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 185 x 3
## # Groups:   carrier [16]
##    carrier month mean_dep_delay
##    &lt;chr&gt;   &lt;int&gt;          &lt;dbl&gt;
##  1 9E          1          16.9 
##  2 9E          2          16.5 
##  3 9E          3          13.4 
##  4 9E          4          13.6 
##  5 9E          5          22.7 
##  6 9E          6          29.0 
##  7 9E          7          31.4 
##  8 9E          8          17.3 
##  9 9E          9           7.75
## 10 9E         10           9.33
## # … with 175 more rows</code></pre>
<hr />
</div>
<div id="you-can-also-use-summarize-on-multiple-variables-columns-for-our-flights-data.-for-our-example-lets-look-at-the-mean-delay-as-well-as-the-minimum-value-for-departure-time" class="section level2">
<h2>You can also use summarize on multiple variables (columns, for our flights data). For our example, let’s look at the mean delay as well as the minimum value for departure time:</h2>
<p>–</p>
<pre class="r"><code>flights %&gt;%
  group_by(carrier, month) %&gt;%
  summarize(mean_dep_delay = mean(dep_delay, na.rm = TRUE),
            min_generation = min(dep_time, na.rm = TRUE))</code></pre>
<pre><code>## `summarise()` regrouping output by &#39;carrier&#39; (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 185 x 4
## # Groups:   carrier [16]
##    carrier month mean_dep_delay min_generation
##    &lt;chr&gt;   &lt;int&gt;          &lt;dbl&gt;          &lt;int&gt;
##  1 9E          1          16.9              15
##  2 9E          2          16.5             555
##  3 9E          3          13.4              14
##  4 9E          4          13.6              15
##  5 9E          5          22.7              33
##  6 9E          6          29.0               7
##  7 9E          7          31.4              13
##  8 9E          8          17.3             651
##  9 9E          9           7.75              3
## 10 9E         10           9.33            636
## # … with 175 more rows</code></pre>
<hr />
</div>
</div>
<div id="long-to-wide-and-wide-to-long" class="section level1">
<h1>Long to wide and wide to long</h1>
<p>–</p>
<div id="our-flights-data-is-currently-in-long-format-which-is-usually-but-not-always-how-you-are-going-to-want-your-data-to-be-for-the-kinds-of-data-analyses-youll-be-doing.-sometimes-you-want-to-turn-your-data-wide." class="section level2">
<h2>Our flights data is currently in “long” format, which is usually (but not always!!) how you are going to want your data to be, for the kinds of data analyses you’ll be doing. Sometimes, you want to turn your data wide.</h2>
<p>–</p>
</div>
<div id="to-do-this-we-can-make-our-data-wide-and-compare-carriers-and-their-departure-delays.-this-is-again-easy-to-do-with-dplyr-using-the-spread-function." class="section level2">
<h2>To do this, we can make our data wide and compare carriers and their departure delays. This is again easy to do with <code>dplyr</code>, using the <code>spread</code> function.</h2>
<p>–</p>
<pre class="r"><code>library(nycflights13)
flights_wide &lt;- flights %&gt;%
  tidyr::spread(carrier, dep_delay)

flights_wide</code></pre>
<pre><code>## # A tibble: 336,776 x 33
##     year month   day dep_time sched_dep_time arr_time sched_arr_time arr_delay
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;
##  1  2013     1     1      517            515      830            819        11
##  2  2013     1     1      533            529      850            830        20
##  3  2013     1     1      542            540      923            850        33
##  4  2013     1     1      544            545     1004           1022       -18
##  5  2013     1     1      554            600      812            837       -25
##  6  2013     1     1      554            558      740            728        12
##  7  2013     1     1      555            600      913            854        19
##  8  2013     1     1      557            600      709            723       -14
##  9  2013     1     1      557            600      838            846        -8
## 10  2013     1     1      558            600      753            745         8
## # … with 336,766 more rows, and 25 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, `9E` &lt;dbl&gt;, AA &lt;dbl&gt;, AS &lt;dbl&gt;, B6 &lt;dbl&gt;,
## #   DL &lt;dbl&gt;, EV &lt;dbl&gt;, F9 &lt;dbl&gt;, FL &lt;dbl&gt;, HA &lt;dbl&gt;, MQ &lt;dbl&gt;, OO &lt;dbl&gt;,
## #   UA &lt;dbl&gt;, US &lt;dbl&gt;, VX &lt;dbl&gt;, WN &lt;dbl&gt;, YV &lt;dbl&gt;</code></pre>
<hr />
</div>
<div id="what-is-happening-with-this-command" class="section level2">
<h2>What is happening with this command?</h2>
<p>–</p>
<div id="spread-requires-you-tell-it-the-name-of-the-column-which-contains-values-that-will-be-the-column-names-in-your-new-data-set---a-so-called-key-column.-you-also-tell-it-which-column-contains-the-relevant-numbers---the-values-column." class="section level3">
<h3><code>spread</code> requires you tell it the name of the column which contains values that will be the column names in your new data set - a so called “key” column. You also tell it which column contains the relevant numbers - the “values” column.</h3>
<p>–</p>
</div>
<div id="in-our-example-here-we-see-that-there-are-quitea-lot-of-nas-so-this-is-not-a-sensible-way-to-organize-our-data." class="section level3">
<h3>In our example here, we see that there are quitea lot of NAs, so this is not a sensible way to organize our data.</h3>
<hr />
</div>
</div>
</div>
<div id="as-i-told-you-a-few-minutes-ago-you-guys-will-usually-be-working-with-long-data.-so-you-will-want-to-know-how-to-transform-your-wide-data-into-this-format." class="section level1">
<h1>As I told you a few minutes ago, you guys will usually be working with “long” data. So, you will want to know how to transform your “wide” data into this format.</h1>
<p>–</p>
<div id="for-this-you-will-use-the-gather-function." class="section level2">
<h2>For this, you will use the <code>gather</code> function.</h2>
<p>–</p>
<div id="in-this-case-you-specify-what-you-want-the-name-of-the-new-key-column-to-be-what-you-want-the-name-of-the-new-values-column-to-be-and-then-you-can-either-specify-which-columns-are-to-be-gathered-up-which-can-be-tedious-if-there-are-a-lot-or-they-are-spread-or-you-can-specify-which-columns-you-want-to-exclude." class="section level3">
<h3>In this case you specify what you want the name of the new key column to be, what you want the name of the new values column to be, and then you can either specify which columns are to be gathered up (which can be tedious if there are a lot or they are spread) or you can specify which columns you want to exclude.</h3>
<p>–</p>
<p>I will show you an example where we <em>exclude</em> a column.</p>
<hr />
<pre class="r"><code># First we create a dataset called stocks
stocks &lt;- tibble(
  time = as.Date(&#39;2009-01-01&#39;) + 0:9,
  X = rnorm(10, 0, 1),
  Y = rnorm(10, 0, 2),
  Z = rnorm(10, 0, 4)
)

#Then we use gather to change the wide data into long format
stocks %&gt;% gather(&quot;stock&quot;, &quot;price&quot;, -time)</code></pre>
<pre><code>## # A tibble: 30 x 3
##    time       stock  price
##    &lt;date&gt;     &lt;chr&gt;  &lt;dbl&gt;
##  1 2009-01-01 X      0.196
##  2 2009-01-02 X     -0.488
##  3 2009-01-03 X     -0.230
##  4 2009-01-04 X      1.59 
##  5 2009-01-05 X     -1.65 
##  6 2009-01-06 X      0.782
##  7 2009-01-07 X      0.986
##  8 2009-01-08 X      2.67 
##  9 2009-01-09 X      0.734
## 10 2009-01-10 X      0.890
## # … with 20 more rows</code></pre>
<hr />
<p>class: center, middle</p>
</div>
</div>
</div>
<div id="and-thats-it-you-now-know-the-basics-of-data-carpentry-with-dplyr." class="section level1">
<h1>And that’s it! You now know the basics of data carpentry with <code>dplyr</code>.</h1>
<p>–</p>
<div id="of-course-r-being-r-there-is-always-more-to-learn-so-be-sure-to-check-out-the-helpful-r-sites-document-to-see-examples-of-more-tutorials." class="section level2">
<h2>Of course, R being R there is always more to learn, so be sure to check out the “Helpful R Sites” document to see examples of more tutorials.</h2>
<hr />
<p>class: center, middle, inverse</p>
</div>
</div>
<div id="acknowledgements" class="section level1">
<h1>Acknowledgements</h1>
<div id="grateful-thanks-to-everyone-on-twitter-and-especially-aleeza-gerstein-at-the-university-of-manitoba-for-kindly-sharing-her-materials." class="section level3">
<h3>Grateful thanks to everyone on Twitter and especially Aleeza Gerstein at the University of Manitoba for kindly sharing her materials.</h3>
</div>
</div>
